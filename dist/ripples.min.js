/**
 * Ripples library v0.1.0 / https://github.com/gsbm/ripples
 * Based on Jquery Ripples plugin / https://github.com/sirxemic/jquery.ripples
 * MIT License
 * @original_author sirxemic / https://sirxemic.com/
 * @author gsbm
 */

!function(e){"use strict";function t(e){return"%"==e[e.length-1]}function r(e,t,r){function i(e,t){var r=n.createShader(e);if(n.shaderSource(r,t),n.compileShader(r),!n.getShaderParameter(r,n.COMPILE_STATUS))throw Error("compile error: "+n.getShaderInfoLog(r));return r}var o={};if(o.id=n.createProgram(),n.attachShader(o.id,i(n.VERTEX_SHADER,e)),n.attachShader(o.id,i(n.FRAGMENT_SHADER,t)),n.linkProgram(o.id),!n.getProgramParameter(o.id,n.LINK_STATUS))throw Error("link error: "+n.getProgramInfoLog(o.id));o.uniforms={},o.locations={},n.useProgram(o.id),n.enableVertexAttribArray(0);for(var a,s,u=/uniform (\w+) (\w+)/g,h=e+t;null!=(a=u.exec(h));)s=a[2],o.locations[s]=n.getUniformLocation(o.id,s);return o}function i(e,t){n.activeTexture(n.TEXTURE0+(t||0)),n.bindTexture(n.TEXTURE_2D,e)}var n,o=function e(){var t=document.createElement("canvas");if(!(n=t.getContext("webgl")||t.getContext("experimental-webgl")))return null;var r={};if(["OES_texture_float","OES_texture_half_float","OES_texture_float_linear","OES_texture_half_float_linear"].forEach(function(e){var t=n.getExtension(e);t&&(r[e]=t)}),!r.OES_texture_float)return null;var i=[];function o(e,t,i){var n="OES_texture_"+e,o=n+"_linear",a=o in r,s=[n];return a&&s.push(o),{type:t,arrayType:i,linearSupport:a,extensions:s}}i.push(o("float",n.FLOAT,Float32Array)),r.OES_texture_half_float&&i.push(o("half_float",r.OES_texture_half_float.HALF_FLOAT_OES,null));var a=n.createTexture(),s=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,s),n.bindTexture(n.TEXTURE_2D,a),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);for(var u=null,h=0;h<i.length;h++)if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,32,32,0,n.RGBA,i[h].type,null),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,a,0),n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE){u=i[h];break}return u}(),a=function e(t,r){try{return new ImageData(t,r)}catch(i){return document.createElement("canvas").getContext("2d").createImageData(t,r)}}(32,32),s=document.createElement("style");s.textContent=".ripples-effect { position: relative; z-index: 0; }",document.head.prepend(s);var u=function(e,t){var r=this;this.el=e,this.interactive=t.interactive,this.resolution=t.resolution,this.textureDelta=new Float32Array([1/this.resolution,1/this.resolution]),this.perturbance=t.perturbance,this.dropRadius=t.dropRadius,this.crossOrigin=t.crossOrigin,this.imageUrl=t.imageUrl;var i=document.createElement("canvas");i.width=this.el.clientWidth,i.height=this.el.clientHeight,this.canvas=i,this.canvas.style.position="absolute",this.canvas.style.left=0,this.canvas.style.top=0,this.canvas.style.right=0,this.canvas.style.bottom=0,this.canvas.style.zIndex=-1,this.el.classList.add("ripples-effect"),this.el.appendChild(i),this.context=n=i.getContext("webgl")||i.getContext("experimental-webgl"),o.extensions.forEach(function(e){n.getExtension(e)}),this.updateSize=this.updateSize.bind(this),window.addEventListener("resize",this.updateSize),this.textures=[],this.framebuffers=[],this.bufferWriteIndex=0,this.bufferReadIndex=1;for(var a=o.arrayType,s=a?new a(this.resolution*this.resolution*4):null,u=0;u<2;u++){var h=n.createTexture(),c=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,c),n.bindTexture(n.TEXTURE_2D,h),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,o.linearSupport?n.LINEAR:n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,o.linearSupport?n.LINEAR:n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,this.resolution,this.resolution,0,n.RGBA,o.type,s),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,h,0),this.textures.push(h),this.framebuffers.push(c)}function d(){r.destroyed||(r.step(),requestAnimationFrame(d))}this.quad=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.quad),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,1,1,-1,1]),n.STATIC_DRAW),this.initShaders(),this.initTexture(),this.setTransparentTexture(),this.loadImage(),n.clearColor(0,0,0,0),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),this.visible=!0,this.running=!0,this.inited=!0,this.destroyed=!1,this.setupPointerEvents(),requestAnimationFrame(d)};u.DEFAULTS={imageUrl:null,resolution:256,dropRadius:20,perturbance:.03,interactive:!0,crossOrigin:""},u.prototype={setupPointerEvents:function(){var e=this;function t(t,r){e.visible&&e.running&&e.interactive&&e.dropAtPointer(t,e.dropRadius*(r?1.5:1),r?.14:.01)}this.el.addEventListener("mousemove",function(e){t(e)}),this.el.addEventListener("touchmove",function(e){for(var r=e.changedTouches,i=0;i<r.length;i++)t(r[i])}),this.el.addEventListener("touchstart",function(e){for(var r=e.changedTouches,i=0;i<r.length;i++)t(r[i])}),this.el.addEventListener("mousedown",function(e){t(e,!0)})},loadImage:function(){var e,t,r=this;n=this.context;var i=this.imageUrl||(e=getComputedStyle(this.el).backgroundImage,null==(t=/url\(["']?([^"']*)["']?\)/.exec(e))?null:t[1]);if(i!=this.imageSource){if(this.imageSource=i,!this.imageSource){this.setTransparentTexture();return}var o,a=new Image;a.onload=function(){function e(e){return(e&e-1)==0}n=r.context;var t=e(a.width)&&e(a.height)?n.REPEAT:n.CLAMP_TO_EDGE;n.bindTexture(n.TEXTURE_2D,r.backgroundTexture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,t),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,a),r.backgroundWidth=a.width,r.backgroundHeight=a.height,r.hideCssBackground()},a.onerror=function(){n=r.context,r.setTransparentTexture()},o=this.imageSource,a.crossOrigin=o.match(/^data:/)?null:this.crossOrigin,a.src=this.imageSource}},step:function(){n=this.context,this.visible&&(this.computeTextureBoundaries(),this.running&&this.update(),this.render())},drawQuad:function(){n.bindBuffer(n.ARRAY_BUFFER,this.quad),n.vertexAttribPointer(0,2,n.FLOAT,!1,0,0),n.drawArrays(n.TRIANGLE_FAN,0,4)},render:function(){n.bindFramebuffer(n.FRAMEBUFFER,null),n.viewport(0,0,this.canvas.width,this.canvas.height),n.enable(n.BLEND),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),n.useProgram(this.renderProgram.id),i(this.backgroundTexture,0),i(this.textures[0],1),n.uniform1f(this.renderProgram.locations.perturbance,this.perturbance),n.uniform2fv(this.renderProgram.locations.topLeft,this.renderProgram.uniforms.topLeft),n.uniform2fv(this.renderProgram.locations.bottomRight,this.renderProgram.uniforms.bottomRight),n.uniform2fv(this.renderProgram.locations.containerRatio,this.renderProgram.uniforms.containerRatio),n.uniform1i(this.renderProgram.locations.samplerBackground,0),n.uniform1i(this.renderProgram.locations.samplerRipples,1),this.drawQuad(),n.disable(n.BLEND)},update:function(){n.viewport(0,0,this.resolution,this.resolution),n.bindFramebuffer(n.FRAMEBUFFER,this.framebuffers[this.bufferWriteIndex]),i(this.textures[this.bufferReadIndex]),n.useProgram(this.updateProgram.id),this.drawQuad(),this.swapBufferIndices()},swapBufferIndices:function(){this.bufferWriteIndex=1-this.bufferWriteIndex,this.bufferReadIndex=1-this.bufferReadIndex},computeTextureBoundaries:function(){var e,r=getComputedStyle(this.el).backgroundSize,i=getComputedStyle(this.el).backgroundAttachment,n=function e(t){var r=t.split(" ");if(1!==r.length)return r.map(function(e){switch(t){case"center":return"50%";case"top":case"left":return"0";case"right":case"bottom":return"100%";default:return e}});switch(t){case"center":return["50%","50%"];case"top":return["50%","0"];case"bottom":return["50%","100%"];case"left":return["0","50%"];case"right":return["100%","50%"];default:return[t,"50%"]}}(getComputedStyle(this.el).backgroundPosition);if("fixed"==i?((e={left:window.pageXOffset,top:window.pageYOffset}).width=window.innerWidth,e.height=window.innerHeight):e=this.el.getBoundingClientRect(),"cover"==r)var o=Math.max(e.width/this.backgroundWidth,e.height/this.backgroundHeight),a=this.backgroundWidth*o,s=this.backgroundHeight*o;else if("contain"==r)var o=Math.min(e.width/this.backgroundWidth,e.height/this.backgroundHeight),a=this.backgroundWidth*o,s=this.backgroundHeight*o;else{var a=(r=r.split(" "))[0]||"",s=r[1]||a;t(a)?a=e.width*parseFloat(a)/100:"auto"!=a&&(a=parseFloat(a)),t(s)?s=e.height*parseFloat(s)/100:"auto"!=s&&(s=parseFloat(s)),"auto"==a&&"auto"==s?(a=this.backgroundWidth,s=this.backgroundHeight):("auto"==a&&(a=this.backgroundWidth*(s/this.backgroundHeight)),"auto"==s&&(s=this.backgroundHeight*(a/this.backgroundWidth)))}var u=n[0],h=n[1];u=t(u)?e.left+(e.width-a)*parseFloat(u)/100:e.left+parseFloat(u),h=t(h)?e.top+(e.height-s)*parseFloat(h)/100:e.top+parseFloat(h);var c=this.el.getBoundingClientRect();this.renderProgram.uniforms.topLeft=new Float32Array([(c.left-u)/a,(c.top-h)/s]),this.renderProgram.uniforms.bottomRight=new Float32Array([this.renderProgram.uniforms.topLeft[0]+this.el.clientWidth/a,this.renderProgram.uniforms.topLeft[1]+this.el.clientHeight/s]);var d=Math.max(this.canvas.width,this.canvas.height);this.renderProgram.uniforms.containerRatio=new Float32Array([this.canvas.width/d,this.canvas.height/d])},initShaders:function(){var e="attribute vec2 vertex;\nvarying vec2 coord;\nvoid main() {\ncoord = vertex * 0.5 + 0.5;\ngl_Position = vec4(vertex, 0.0, 1.0);\n}";this.dropProgram=r(e,"precision highp float;\nconst float PI = 3.141592653589793;\nuniform sampler2D texture;\nuniform vec2 center;\nuniform float radius;\nuniform float strength;\nvarying vec2 coord;\nvoid main() {\nvec4 info = texture2D(texture, coord);\nfloat drop = max(0.0, 1.0 - length(center * 0.5 + 0.5 - coord) / radius);\ndrop = 0.5 - cos(drop * PI) * 0.5;\ninfo.r += drop * strength;\ngl_FragColor = info;\n}"),this.updateProgram=r(e,"precision highp float;\nuniform sampler2D texture;\nuniform vec2 delta;\nvarying vec2 coord;\nvoid main() {\nvec4 info = texture2D(texture, coord);\nvec2 dx = vec2(delta.x, 0.0);\nvec2 dy = vec2(0.0, delta.y);\nfloat average = (\ntexture2D(texture, coord - dx).r +\ntexture2D(texture, coord - dy).r +\ntexture2D(texture, coord + dx).r +\ntexture2D(texture, coord + dy).r\n) * 0.25;\ninfo.g += (average - info.r) * 2.0;\ninfo.g *= 0.995;\ninfo.r += info.g;\ngl_FragColor = info;\n}"),n.uniform2fv(this.updateProgram.locations.delta,this.textureDelta),this.renderProgram=r("precision highp float;\nattribute vec2 vertex;\nuniform vec2 topLeft;\nuniform vec2 bottomRight;\nuniform vec2 containerRatio;\nvarying vec2 ripplesCoord;\nvarying vec2 backgroundCoord;\nvoid main() {\nbackgroundCoord = mix(topLeft, bottomRight, vertex * 0.5 + 0.5);\nbackgroundCoord.y = 1.0 - backgroundCoord.y;\nripplesCoord = vec2(vertex.x, -vertex.y) * containerRatio * 0.5 + 0.5;\ngl_Position = vec4(vertex.x, -vertex.y, 0.0, 1.0);\n}","precision highp float;\nuniform sampler2D samplerBackground;\nuniform sampler2D samplerRipples;\nuniform vec2 delta;\nuniform float perturbance;\nvarying vec2 ripplesCoord;\nvarying vec2 backgroundCoord;\nvoid main() {\nfloat height = texture2D(samplerRipples, ripplesCoord).r;\nfloat heightX = texture2D(samplerRipples, vec2(ripplesCoord.x + delta.x, ripplesCoord.y)).r;\nfloat heightY = texture2D(samplerRipples, vec2(ripplesCoord.x, ripplesCoord.y + delta.y)).r;\nvec3 dx = vec3(delta.x, heightX - height, 0.0);\nvec3 dy = vec3(0.0, heightY - height, delta.y);\nvec2 offset = -normalize(cross(dy, dx)).xz;\nfloat specular = pow(max(0.0, dot(offset, normalize(vec2(-0.6, 1.0)))), 4.0);\ngl_FragColor = texture2D(samplerBackground, backgroundCoord + offset * perturbance) + specular;\n}"),n.uniform2fv(this.renderProgram.locations.delta,this.textureDelta)},initTexture:function(){this.backgroundTexture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.backgroundTexture),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,1),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR)},setTransparentTexture:function(){n.bindTexture(n.TEXTURE_2D,this.backgroundTexture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,a)},hideCssBackground:function(){var e=this.el.style.backgroundImage;"none"!=e&&(this.originalInlineCss=e,this.originalCssBackgroundImage=getComputedStyle(this.el).backgroundImage,this.el.style.backgroundImage="none")},restoreCssBackground:function(){this.el.style.backgroundImage=this.originalInlineCss||""},dropAtPointer:function(e,t,r){var i=parseInt(getComputedStyle(this.el).borderLeftWidth)||0,n=parseInt(getComputedStyle(this.el).borderTopWidth)||0;this.drop(e.pageX-this.el.getBoundingClientRect().left-i,e.pageY-this.el.getBoundingClientRect().top-n,t,r)},drop:function(e,t,r,o){n=this.context;var a=this.el.clientWidth,s=this.el.clientHeight,u=Math.max(a,s);r/=u;var h=new Float32Array([(2*e-a)/u,(s-2*t)/u]);n.viewport(0,0,this.resolution,this.resolution),n.bindFramebuffer(n.FRAMEBUFFER,this.framebuffers[this.bufferWriteIndex]),i(this.textures[this.bufferReadIndex]),n.useProgram(this.dropProgram.id),n.uniform2fv(this.dropProgram.locations.center,h),n.uniform1f(this.dropProgram.locations.radius,r),n.uniform1f(this.dropProgram.locations.strength,o),this.drawQuad(),this.swapBufferIndices()},updateSize:function(){var e=this.el.clientWidth,t=this.el.clientHeight;(e!=this.canvas.width||t!=this.canvas.height)&&(this.canvas.width=e,this.canvas.height=t)},destroy:function(){this.el.removeEventListener("mousemove",this.updateSize),this.el.removeEventListener("touchmove",this.updateSize),this.el.removeEventListener("touchstart",this.updateSize),this.el.removeEventListener("mousedown",this.updateSize),this.el.classList.remove("ripples-effect"),n=null,window.removeEventListener("resize",this.updateSize),this.canvas.remove(),this.restoreCssBackground(),this.destroyed=!0},show:function(){this.visible=!0,this.canvas.style.display="block",this.hideCssBackground()},hide:function(){this.visible=!1,this.canvas.style.display="none",this.restoreCssBackground()},pause:function(){this.running=!1},play:function(){this.running=!0},set:function(e,t){switch(e){case"dropRadius":case"perturbance":case"interactive":case"crossOrigin":this[e]=t;break;case"imageUrl":this.imageUrl=t,this.loadImage()}}},e.ripples=function e(t,r){if(!o)throw Error("Your browser does not support WebGL, the OES_texture_float extension or rendering to floating point textures.");var i=arguments.length>1?Array.prototype.slice.call(arguments,1):void 0,n=t.ripplesInstance,a=Object.assign({},u.DEFAULTS,"object"==typeof r&&r);n?"string"==typeof r&&u.prototype[r].apply(n,i):t.ripplesInstance=new u(t,a)}}(this);
